<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>8.3-DevOps发布流程 | 运维规范文档</title>
  <link rel="stylesheet" href="/KOpsDoc/assets/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
  <script>
    var BASEURL = "/KOpsDoc";
  </script>
  <script src="/KOpsDoc/assets/js/search.js" defer></script>
  <script src="/KOpsDoc/assets/js/theme.js" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (window.mermaid) {
        mermaid.initialize({ startOnLoad: false });
        document.querySelectorAll('code.language-mermaid, code.mermaid').forEach(function(block, i) {
          var pre = block.parentElement;
          var code = block.textContent;
          var container = document.createElement('div');
          container.className = 'mermaid';
          container.textContent = code;
          pre.parentNode.replaceChild(container, pre);
          try { mermaid.init(undefined, container); } catch(e) {}
        });
      }
    });
  </script>
</head>
<body>
  <header class="book-header">
    <a href="/KOpsDoc/" class="book-logo" aria-label="返回首页">运维规范文档</a>
    <button id="theme-toggle" onclick="toggleTheme()" aria-label="切换主题" type="button">
      <i id="theme-toggle-icon" class="ti ti-moon-stars"></i>
    </button>
  </header>
  <div class="book-container">
    <aside class="book-sidebar">
      <nav>
        <input type="search" id="doc-search" placeholder="搜索文档..." autocomplete="off" />
        <div id="search-results" class="search-results"></div>
        <h2>文档导航</h2>
        <ul>
        
        
        
        
          <li class="nav-group"><strong>0. 目录与索引</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/%E7%9B%AE%E5%BD%95%E6%B8%85%E5%8D%95.html">目录清单</a></li>
              
            
              
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>1. 基础通用规范</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/1.1-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83.html">1.1-基础设施命名规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/1.2-%E4%B8%BB%E6%9C%BA%E4%B8%8E%E8%B5%84%E4%BA%A7%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83.html">1.2-主机与资产管理规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/1.3-%E8%B4%A6%E5%8F%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83.html">1.3-账号与权限管理规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/1.4-%E6%96%87%E6%A1%A3%E4%B8%8E%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83.html">1.4-文档与知识管理规范</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>2. 变更与发布管理</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/2.1-%E5%8F%98%E6%9B%B4%E4%B8%8E%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83.html">2.1-变更与发布管理规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/2.1-%E5%8F%98%E6%9B%B4%E4%B8%8E%E5%8F%91%E5%B8%83%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83-%E6%A1%88%E4%BE%8B%E9%9B%86%E9%94%A6.html">2.1-变更与发布管理规范-案例集锦</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/2.2-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B8%8E%E8%84%9A%E6%9C%AC%E8%A7%84%E8%8C%83.html">2.2-自动化运维与脚本规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/2.3-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%BC%94%E7%BB%83%E8%A7%84%E8%8C%83.html">2.3-自动化测试与演练规范</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>3. 监控与可观测性</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/3.1-%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%91%8A%E8%AD%A6%E8%A7%84%E8%8C%83.html">3.1-监控与告警规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/3.1-%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%91%8A%E8%AD%A6%E8%A7%84%E8%8C%83-%E6%B5%81%E7%A8%8B%E5%9B%BE.html">3.1-监控与告警规范-流程图</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/3.2-%E6%97%A5%E5%BF%97%E4%B8%8E%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7%E8%A7%84%E8%8C%83.html">3.2-日志与可观测性规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/3.3-%E8%BF%90%E7%BB%B4%E8%B4%A8%E9%87%8F%E4%B8%8E%E6%95%88%E8%83%BD%E5%BA%A6%E9%87%8F%E8%A7%84%E8%8C%83.html">3.3-运维质量与效能度量规范</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>4. 安全与合规</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/4.1-%E5%AE%89%E5%85%A8%E5%90%88%E8%A7%84%E4%B8%8E%E5%AE%A1%E8%AE%A1%E8%A7%84%E8%8C%83.html">4.1-安全合规与审计规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/4.2-%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%81%E4%BF%9D%E6%8A%A4%E8%A7%84%E8%8C%83.html">4.2-数据安全与隐私保护规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/4.3-%E8%BF%90%E7%BB%B4%E5%AE%89%E5%85%A8%E5%BA%94%E6%80%A5%E6%BC%94%E7%BB%83%E8%A7%84%E8%8C%83.html">4.3-运维安全应急演练规范</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>5. 云原生与智能运维</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/5.1-%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E5%8E%9F%E7%94%9F%E8%BF%90%E7%BB%B4%E8%A7%84%E8%8C%83.html">5.1-容器与云原生运维规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/5.2-CI_CD%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A7%84%E8%8C%83.html">5.2-CI_CD流水线与自动化规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/5.3-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%8D%B3%E4%BB%A3%E7%A0%81%EF%BC%88IaC%EF%BC%89%E8%A7%84%E8%8C%83.html">5.3-基础设施即代码（IaC）规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/5.4-%E5%A4%9A%E4%BA%91%E4%B8%8E%E6%B7%B7%E5%90%88%E4%BA%91%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83.html">5.4-多云与混合云管理规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/5.5-AIOps%E4%B8%8E%E6%99%BA%E8%83%BD%E8%BF%90%E7%BB%B4%E8%A7%84%E8%8C%83.html">5.5-AIOps与智能运维规范</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>6. 运营与可持续发展</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/6.1-%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D%E8%A7%84%E8%8C%83.html">6.1-备份与恢复规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/6.2-%E4%BE%9B%E5%BA%94%E5%95%86%E4%B8%8E%E5%A4%96%E5%8C%85%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83.html">6.2-供应商与外包管理规范</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/6.3-%E7%BB%BF%E8%89%B2%E8%BF%90%E7%BB%B4%E4%B8%8E%E5%8F%AF%E6%8C%81%E7%BB%AD%E5%8F%91%E5%B1%95%E8%A7%84%E8%8C%83.html">6.3-绿色运维与可持续发展规范</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>7. 工具与补充清单</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/7.1-%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%B8%85%E5%8D%95.html">7.1-运维常用工具清单</a></li>
              
            
            </ul>
          </li>
        
          <li class="nav-group"><strong>8. 补充SOP与实用手册</strong>
            <ul>
            
              
              
                
                <li><a href="/KOpsDoc/8.1-%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5SOP.html">8.1-安全策略SOP</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/8.2-%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html">8.2-灾难恢复流程</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/8.3-DevOps%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B.html" class="active">8.3-DevOps发布流程</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/8.4-%E5%B7%A1%E6%A3%80%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC.html">8.4-巡检与自动化脚本</a></li>
              
            
              
              
                
                <li><a href="/KOpsDoc/8.5-%E5%80%BC%E7%8F%AD%E6%89%8B%E5%86%8C.html">8.5-值班手册</a></li>
              
            
            </ul>
          </li>
        </ul>
      </nav>
    </aside>
    <main class="book-content">
      <article>
        
        <h1 id="83-devops-发布流程">8.3 DevOps 发布流程</h1>

<h2 id="一适用范围与目标">一、适用范围与目标</h2>

<ul>
  <li>适用于应用、服务、配置等的发布、更新、回滚等 DevOps 操作。</li>
  <li>目标：建立标准化的发布流程，保障发布安全，降低发布风险，提升发布效率。</li>
</ul>

<h2 id="二管理目标">二、管理目标</h2>

<ol>
  <li>发布流程标准化，支持多种发布策略</li>
  <li>发布过程可追溯、可回滚</li>
  <li>自动化发布与人工审核相结合</li>
  <li>发布后验证与监控完善</li>
</ol>

<h2 id="三详细规范">三、详细规范</h2>

<h3 id="蓝绿发布">蓝绿发布</h3>

<ul>
  <li><strong>原理</strong>：新旧环境并行，通过流量切换实现零停机发布</li>
  <li><strong>适用场景</strong>：需要快速回滚的场景，对停机时间要求高的场景</li>
  <li><strong>优势</strong>：零停机、快速回滚、风险可控</li>
  <li><strong>注意事项</strong>：需要双倍资源，数据兼容性要求高</li>
</ul>

<h3 id="灰度发布金丝雀发布">灰度发布（金丝雀发布）</h3>

<ul>
  <li><strong>原理</strong>：逐步将流量切换到新版本，监控指标，无异常后全量发布</li>
  <li><strong>适用场景</strong>：需要逐步验证新版本的场景，降低发布风险</li>
  <li><strong>优势</strong>：风险可控、可逐步验证、支持快速回滚</li>
  <li><strong>注意事项</strong>：需要流量控制能力，监控指标完善</li>
</ul>

<h3 id="滚动发布">滚动发布</h3>

<ul>
  <li><strong>原理</strong>：逐步替换旧版本实例，保持服务可用</li>
  <li><strong>适用场景</strong>：Kubernetes 等容器平台的标准发布方式</li>
  <li><strong>优势</strong>：资源利用率高、发布平滑</li>
  <li><strong>注意事项</strong>：需要健康检查，确保新实例就绪</li>
</ul>

<h3 id="回滚机制">回滚机制</h3>

<ul>
  <li><strong>镜像回退</strong>：回退到上一个稳定版本</li>
  <li><strong>配置回退</strong>：回退配置变更</li>
  <li><strong>数据回滚</strong>：数据库变更回滚（需谨慎）</li>
  <li><strong>自动化回滚</strong>：监控异常自动触发回滚</li>
</ul>

<h2 id="四操作流程">四、操作流程</h2>

<h3 id="蓝绿发布流程">蓝绿发布流程</h3>

<ol>
  <li><strong>发布前检查</strong> → 检查依赖、配置、回滚方案</li>
  <li><strong>部署新版本</strong> → 部署新版本到”绿”环境</li>
  <li><strong>健康检查</strong> → 检查新版本健康状态</li>
  <li><strong>流量切换</strong> → 逐步或一次性切换流量到新版本</li>
  <li><strong>监控验证</strong> → 监控业务指标，验证功能正常</li>
  <li><strong>保留旧版本</strong> → 保留”蓝”环境一段时间以便回滚</li>
  <li><strong>清理资源</strong> → 确认无问题后清理旧版本资源</li>
</ol>

<h3 id="灰度发布流程">灰度发布流程</h3>

<ol>
  <li><strong>发布前检查</strong> → 检查依赖、配置、回滚方案</li>
  <li><strong>部署新版本</strong> → 部署新版本实例</li>
  <li><strong>小流量验证</strong> → 切换 5-10% 流量到新版本</li>
  <li><strong>监控指标</strong> → 监控错误率、响应时间、业务指标</li>
  <li><strong>逐步放量</strong> → 无异常后逐步增加流量（10% → 50% → 100%）</li>
  <li><strong>全量发布</strong> → 所有流量切换到新版本</li>
  <li><strong>清理旧版本</strong> → 确认无问题后清理旧版本</li>
</ol>

<h3 id="回滚流程">回滚流程</h3>

<ol>
  <li><strong>触发回滚</strong> → 检测到异常或手动触发回滚</li>
  <li><strong>评估影响</strong> → 评估回滚的影响范围</li>
  <li><strong>执行回滚</strong> → 回退到上一个稳定版本</li>
  <li><strong>验证业务</strong> → 验证业务功能恢复正常</li>
  <li><strong>记录归档</strong> → 记录回滚原因和过程</li>
  <li><strong>问题分析</strong> → 分析问题原因，制定改进措施</li>
</ol>

<h2 id="五实际案例">五、实际案例</h2>

<h3 id="案例1蓝绿发布-web-服务">案例1：蓝绿发布 Web 服务</h3>

<ul>
  <li><strong>场景</strong>：生产环境 Web 服务版本更新</li>
  <li><strong>步骤</strong>：
    <ol>
      <li>部署新版本到”绿”环境</li>
      <li>健康检查通过</li>
      <li>切换 50% 流量到新版本</li>
      <li>监控 10 分钟无异常</li>
      <li>切换 100% 流量到新版本</li>
      <li>保留”蓝”环境 24 小时</li>
    </ol>
  </li>
  <li><strong>结果</strong>：零停机发布，业务无影响</li>
  <li><strong>亮点</strong>：分阶段切换，风险可控</li>
</ul>

<h3 id="案例2灰度发布-api-服务">案例2：灰度发布 API 服务</h3>

<ul>
  <li><strong>场景</strong>：API 服务重大版本更新</li>
  <li><strong>步骤</strong>：
    <ol>
      <li>部署新版本实例</li>
      <li>切换 5% 流量到新版本</li>
      <li>监控 30 分钟，错误率正常</li>
      <li>切换 20% 流量，继续监控</li>
      <li>逐步增加到 100% 流量</li>
      <li>清理旧版本实例</li>
    </ol>
  </li>
  <li><strong>结果</strong>：逐步验证，无异常</li>
  <li><strong>亮点</strong>：逐步放量，风险可控</li>
</ul>

<h3 id="案例3自动回滚">案例3：自动回滚</h3>

<ul>
  <li><strong>场景</strong>：发布后检测到错误率上升</li>
  <li><strong>步骤</strong>：
    <ol>
      <li>监控系统检测到错误率 &gt; 1%</li>
      <li>自动触发回滚流程</li>
      <li>回退到上一个稳定版本</li>
      <li>验证业务恢复正常</li>
      <li>通知相关人员</li>
      <li>分析问题原因</li>
    </ol>
  </li>
  <li><strong>结果</strong>：2 分钟内完成回滚，业务恢复</li>
  <li><strong>亮点</strong>：自动化回滚，快速恢复</li>
</ul>

<h2 id="六操作模板">六、操作模板</h2>

<h3 id="发布前检查清单">发布前检查清单</h3>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># 发布前检查清单</span>

<span class="gu">## 代码与配置</span>
<span class="p">-</span> [ ] 代码已通过测试
<span class="p">-</span> [ ] 配置文件已更新
<span class="p">-</span> [ ] 依赖版本已确认
<span class="p">-</span> [ ] 数据库变更已准备

<span class="gu">## 发布方案</span>
<span class="p">-</span> [ ] 发布策略已确定（蓝绿/灰度/滚动）
<span class="p">-</span> [ ] 回滚方案已准备
<span class="p">-</span> [ ] 发布窗口已确定
<span class="p">-</span> [ ] 相关人员已通知

<span class="gu">## 监控与告警</span>
<span class="p">-</span> [ ] 监控指标已配置
<span class="p">-</span> [ ] 告警规则已设置
<span class="p">-</span> [ ] 监控面板已准备
<span class="p">-</span> [ ] 值班人员已就位
</code></pre></div></div>

<h3 id="蓝绿发布脚本示例kubernetes">蓝绿发布脚本示例（Kubernetes）</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 部署新版本（绿环境）</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app-green</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">green</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">version</span><span class="pi">:</span> <span class="s">green</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">app</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:v2.0</span>
<span class="nn">---</span>
<span class="c1"># 服务流量切换</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">myapp</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">green</span>  <span class="c1"># 切换到绿环境</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
</code></pre></div></div>

<h3 id="灰度发布配置示例istio">灰度发布配置示例（Istio）</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.istio.io/v1alpha3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualService</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myapp</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">myapp</span>
  <span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">match</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">headers</span><span class="pi">:</span>
        <span class="na">canary</span><span class="pi">:</span>
          <span class="na">exact</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">route</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v2</span>
      <span class="na">weight</span><span class="pi">:</span> <span class="m">100</span>
  <span class="pi">-</span> <span class="na">route</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v1</span>
      <span class="na">weight</span><span class="pi">:</span> <span class="m">90</span>
    <span class="pi">-</span> <span class="na">destination</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">myapp</span>
        <span class="na">subset</span><span class="pi">:</span> <span class="s">v2</span>
      <span class="na">weight</span><span class="pi">:</span> <span class="m">10</span>
</code></pre></div></div>

<h3 id="回滚脚本示例">回滚脚本示例</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># 回滚脚本</span>

<span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"myapp"</span>
<span class="nv">PREVIOUS_VERSION</span><span class="o">=</span><span class="s2">"v1.0"</span>

<span class="nb">echo</span> <span class="s2">"开始回滚 </span><span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span><span class="s2"> 到 </span><span class="k">${</span><span class="nv">PREVIOUS_VERSION</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># 回滚 Deployment</span>
kubectl rollout undo deployment/<span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span>

<span class="c"># 等待回滚完成</span>
kubectl rollout status deployment/<span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span>

<span class="c"># 验证服务</span>
kubectl get pods <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span><span class="k">${</span><span class="nv">APP_NAME</span><span class="k">}</span>

<span class="nb">echo</span> <span class="s2">"回滚完成"</span>
</code></pre></div></div>

<h2 id="七注意事项">七、注意事项</h2>

<ul>
  <li><strong>发布过程全程审计</strong>：所有发布操作需记录，便于追溯</li>
  <li><strong>回滚方案需提前验证</strong>：回滚方案需在测试环境验证</li>
  <li><strong>灰度/蓝绿需有流量切换与监控</strong>：确保有完善的流量控制和监控</li>
  <li><strong>发布窗口选择</strong>：选择业务低峰期发布，降低影响</li>
  <li><strong>数据兼容性</strong>：确保新版本与旧版本数据兼容</li>
  <li><strong>通知机制</strong>：发布前后及时通知相关人员</li>
</ul>

<h2 id="八参考资料">八、参考资料</h2>

<ul>
  <li>《DevOps 发布最佳实践》</li>
  <li>《Kubernetes 发布与回滚白皮书》</li>
  <li>《Istio 流量管理指南》</li>
  <li>团队内部发布流程规范</li>
</ul>

      </article>
    </main>
  </div>
  <footer class="book-footer">
    <p>© 2026 运维规范文档 | Powered by Jekyll and AI</p>
  </footer>
  <button class="sidebar-toggle-btn" id="sidebarToggleBtn" aria-label="展开/收起导航" type="button">
    <i class="ti ti-menu-2" style="font-size:1.5em;"></i>
  </button>
</body>
<script>
  // 移动端侧边栏收起/展开逻辑
  (function() {
    function toggleSidebar(open) {
      var sidebar = document.querySelector('.book-sidebar');
      if (!sidebar) return;
      if (open === undefined) {
        sidebar.classList.toggle('open');
      } else if (open) {
        sidebar.classList.add('open');
      } else {
        sidebar.classList.remove('open');
      }
    }

    function handleSidebarBtn() {
      var btn = document.getElementById('sidebarToggleBtn');
      var sidebar = document.querySelector('.book-sidebar');
      if (!btn || !sidebar) return;

      function check() {
        if (window.innerWidth <= 900) {
          btn.style.display = 'flex';
          if (!sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
          }
        } else {
          btn.style.display = 'none';
          sidebar.classList.remove('open');
        }
      }

      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleSidebar();
      });

      // 点击外部关闭侧边栏
      document.addEventListener('click', function(e) {
        if (window.innerWidth > 900) return;
        var sidebar = document.querySelector('.book-sidebar');
        if (sidebar && sidebar.classList.contains('open') && 
            !sidebar.contains(e.target) && 
            e.target !== btn && 
            !btn.contains(e.target)) {
          sidebar.classList.remove('open');
        }
      });

      // ESC 键关闭侧边栏
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          var sidebar = document.querySelector('.book-sidebar');
          if (sidebar && sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
          }
        }
      });

      window.addEventListener('resize', check);
      check();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', handleSidebarBtn);
    } else {
      handleSidebarBtn();
    }
  })();
</script>
</html>